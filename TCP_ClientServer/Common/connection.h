#pragma once

#include "common.h"
#include "tsqueue.h"
#include "message.h"

template <typename T>
class Connection : public std::enable_shared_from_this<connection<T>>
{
public:
	Connection()
	{
	}

	virtual ~Connection()
	{
	}

	bool ConnectionToServer();
	bool Disconnectrd();
	bool IsConnected() const;

	bool Send(const messageBody<T>& msg);

protected:
	// Каждое соединение имеет уникальный сокет для подключения к удаленному компьютеру. 
	asio::ip::tcp::socket socket;

	// Этот контекст является общим для всего экземпляра asio
	asio::io_context& asioContext;

	// В этой очереди хранятся все сообщения, которые должны быть отправлены удаленной стороне
	// этого соединения
	tsqueue<messageBody<T>> qMessagesOut;

	// Cсылается на входящую очередь родительского объекта
	tsqueue<ownedMessage<T>>& qMessagesIn;
};
